@model IEnumerable<PrachiIndia.Sql.ChapterContent>
@{
    ViewBag.Title = "ContentList";
    var chapter = ViewBag.Chapter as PrachiIndia.Sql.Chapter;
}
@using PrachiIndia.Web.Areas.Model;
<style type="text/css">
    #tbody a {
        cursor: pointer;
    }
</style>
<div class="panel-body inprdservice">
    <div class="col-md-12 inprdservicehead" style="margin-bottom:0;">
        <div class="panel-header">
            <h4 class="card-title">
                @ViewBag.BookName<span class="pull-right">
                <a href="@Url.Action("ManageContents", "Admin", new { ChapterId = chapter.Id })" class="pull-right btn" title='Create new chapters'><i class="fa fa-plus"> </i></a>
                &nbsp;<a href="/CPanel/Admin/BookDetails?id=@ViewBag.BookId" class="pull-right btn" title="Back to chapters"><i class="fa fa-arrow-left"> </i></a>
            </span>
        </h4>
    </div>
</div>
<div class="panel-body">
    <div class="col-md-12">
        <h4>
            @chapter.ChapterIndex - @chapter.Title - Contents (@Model.Count())
        </h4>
    </div>
    <table class="table-responsive table table-bordered">
        <thead>
            <tr><th>Sr No#</th><th>Title</th><th>Content Type</th><th>Action</th></tr>
        </thead>

        @{ var groups = Model.GroupBy(t => t.Type);
            int count = 0;
            foreach (var contents in groups)
            {
                <tbody id="tbody">
                    <tr>
                        <td colspan="6">
                            <h3 class="text-info text-center">
                                @Enum.GetName(typeof(ChapterType), contents.Key)
                            </h3>
                        </td>
                    </tr>
                    @foreach (var content in contents)
                    {
                        var filePath = string.Empty;
                        if (contents.Key == ChapterType.Solutions.GetHashCode())
                        {
                            filePath = @Url.Content("~/ModuleFiles/Chapters/Solutions/") + content.Name;
                        }
                        else if (contents.Key == ChapterType.Lesson_Plan.GetHashCode())
                        {
                            filePath = @Url.Content("~/ModuleFiles/Chapters/LessonPlan/") + content.Name;
                        }
                        else if (contents.Key == ChapterType.Workheet.GetHashCode())
                        {
                            filePath = @Url.Content("~/ModuleFiles/Chapters/WorkSheets/") + content.Name;
                        }
                        else if (contents.Key == ChapterType.Audio_Video.GetHashCode())
                        {
                            filePath = @Url.Content("~/ModuleFiles/Chapters/Audio/") + content.Name;
                        }
                        <tr>
                            <td>@(count + 1)</td>
                            @*<td>@Enum.GetName(typeof(ChapterType), content.Type)</td>*@
                            <td><a href="@filePath" id=@content.Name class="viewFile" target="_blank">@content.Title</a></td>
                            <td>@Enum.GetName(typeof(contentType), content.ContentType)</td>
                            <td>
                                @if (content.Status == 1)
                                {
                                    <input type="checkbox" checked="checked" title="Make It Inactive" style="cursor:pointer;position: static;" onchange="ActiveInactive(@content.Id,@content.BookId,this)" />
                                }
                                else
                                {
                                    <input type="checkbox" title="Make It Active" style="cursor:pointer;position: static;" onchange="ActiveInactive(@content.Id,@content.BookId,this)" />
                                }
                                &nbsp;
                                &nbsp;
                                &nbsp;
                                <a title="Edit Content" class="text-primary" href="@Url.Action("ManageContents", "Admin", new { ChapterId = content.ChapterId, ContentId=content.Id })"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp; &nbsp;
                                <button id="btnSyn" title="Sync ReadEdge" class="text-primary" onclick="sync(@content.Id,@content.ChapterId,@content.BookId,@content.Type,@content.ContentType)"><i class="fa fa-refresh"></i></button>&nbsp;
                            </td>
                        </tr>
                        count = (count + 1);
                    }
                </tbody>
            }
        }

    </table>

</div>
</div>






<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
<link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    function ActiveInactive(ID, BookId, object) {
        var ckb = $(object).is(':checked');
        $.ajax({
            type: "POST",
            url: "/Admin/DeleteContent",
            data: { ContentID: ID, BookId: BookId, Flag: ckb },
            success: function (data) {
                if (data == 'true')
                    toastr.success("Content Activated Successfully", '', { timeOut: 5000 })
                else
                    toastr.success("Content Deactivated Successfully", '', { timeOut: 5000 })
            },
            error: function () {
                alert("Error occured!!")
            }
        });

    }

    //  $(document).ready(function () {
    function sync(contentId, ChapterId, BookId, Type, ContentType) {
        if (confirm(" Are you sure to sync with Readedge ?")) {
            $.ajax({
                type: "POST",
                url: "/Admin/SyncReadEdge",
                data: { contentId: contentId, ChapterId: ChapterId, BookId: BookId, Type: Type, ContentType: ContentType },
                success: function (data) {
                    if (data == 'true')
                        toastr.success("Content sync with ReadEdge Successfully", '', { timeOut: 5000 })
                    else
                        toastr.error("Some issue please try later.", '', { timeOut: 5000 })
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }
        else { return; }

    }
        //$("#btnSyn").click(function () {
        //    if (confirm(" Are you sure to sync with Readedge.")) {
        //        $.ajax({
        //            type: "POST",
        //            url: "/Admin/SyncReadEdge",
        //            success: function (data) {
        //                if (data == 'true')
        //                    toastr.success("Content sync with ReadEdge Successfully", '', { timeOut: 5000 })
        //                else
        //                    toastr.error("Some issue please try later.", '', { timeOut: 5000 })
        //            },
        //            error: function () {
        //                alert("Error occured!!")
        //            }
        //        });
        //    }
        //    else { return; }
        //});
    //});
</script>
@*$('.viewFile').click(function () {
            var FileName = $(this).attr("id");
            var href = "@Url.Content("/ModuleFiles/Chapters/Solutions/2015325114919526.pdf")"
            $("#dialog").dialog({
                modal: true,
                title: FileName,
                width: 540,
                height: 450,
                buttons: {
                    Close: function () {
                        $(this).dialog('close');
                    }
                },
                open: function () {
                    var object = "<object data=\"{href}\" type=\"application/pdf\" width=\"500px\" height=\"300px\">";
                    object += "If you are unable to view file, you can download from <a href = \"{href}\">here</a>";
                    object += " or download <a target = \"_blank\" href = \"http://get.adobe.com/reader/\">Adobe PDF Reader</a> to view the file.";
                    object += "</object>";
                    object = object.replace(/{href}/g, "Files/" + href);
                    $("#dialog").html(object);
                }
            });
        });


    <div id="dialog" style="display: none">
    </div>*@
